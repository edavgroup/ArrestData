# Results


```{r}
library(dplyr)
library(tibble)
library(tidyr)
library(ggplot2)
library(forcats)
library(RSocrata)
library(redav)
library(UpSetR)
library(naniar)
library(rvest)
library(ggpubr)
library(ggalluvial)
library(RColorBrewer)
```


We start to analyze the crime pattern with plotting the criminals' portrait.

With the arrest records, we plot the basic information (age, gender and race) for all arrestees. Then we could depicting the portraits for those criminal group.


```{r}
data =  read.socrata("https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc")
data <- data %>%
  drop_na(pd_desc, ky_cd, pd_cd)

figure1 <- ggplot(data, aes(x=age_group))+ 
  geom_histogram(stat="count",position="identity", alpha=0.5)+
  coord_flip()+
  labs(caption="Figure.1 Age Distribution of the Criminals", 
       x="age", y="count")+ 
  theme_minimal()

figure2 <- ggplot(data, aes(x=perp_sex))+ 
  geom_histogram(stat="count",position="identity", alpha=0.5)+
  coord_flip()+
  labs(caption="Figure.2 Sex Distribution of the Criminals", 
       x="sex", y="count")+ 
  theme_minimal()

ggarrange(figure1, figure2, ncol = 2, nrow = 1)
```


```{r}
figure3 <- ggplot(data, aes(x=perp_race))+ 
  geom_histogram(stat="count",position="identity", alpha=0.5)+
  coord_flip()+
  labs(caption="Figure.3 Race Distribution of the Criminals", 
       x="race", y="count")+ 
  theme_minimal()

figure3
```

From the above three figures, we can observe the following characteristics of the captured criminalsï¼š
1. Men dominate.
2. The age group shows an approximate natural distribution pattern, mainly concentrated in 25-44 years old.
3. Black and White Hispanic mainly.
Such data can help police better understand the psychology of criminal groups.


So there is another question: What is the connection between these crime figures and the specific types of crime correspondingly?

Firstly, we calculate the frequency of all crime types as shown in table below.

```{r}
cat_nyc <- select(data, ofns_desc)

crime_category_table <- table(cat_nyc$ofns_desc)
crime_category_table <- sort(crime_category_table, decreasing = TRUE)

crime_by_category <- as.data.frame(crime_category_table, stringsAsFactors = FALSE)
colnames(crime_by_category) <- c("Category", "Frequency")
crime_by_category$Percentage <- crime_by_category$Frequency / sum(crime_by_category$Frequency) * 100
crime_by_category
```
We can see that there are 64 types in total. To have a clear understanding of the data, we select 7 types whose percentage is higher than 5% among the total observations for the further analysis.

They are [ASSAULT 3 & RELATED OFFENSES, PETIT LARCENY, FELONY ASSAULT, MISCELLANEOUS PENAL LAW, CRIMINAL MISCHIEF & RELATED OF, DANGEROUS DRUGS, ROBBERY].

```{r}
# for bed = 2
high_freq_crime_types <- data %>% filter((ofns_desc == "ASSAULT 3 & RELATED OFFENSES") | (ofns_desc == "PETIT LARCENY") | (ofns_desc == "FELONY ASSAULT") | (ofns_desc == "MISCELLANEOUS PENAL LAW") | (ofns_desc == "CRIMINAL MISCHIEF & RELATED OF") | (ofns_desc == "DANGEROUS DRUGS") | (ofns_desc == "ROBBERY") )

high_freq_crime_types

```

Here we made an mosaic diagram to show the relationship between the criminals and the crime types.

```{r}
library(ggmosaic)
library(vcd)
df_type <- select(high_freq_crime_types,c(age_group, perp_sex, ofns_desc))
color= brewer.pal(7,"Blues")
vcd::mosaic(ofns_desc~age_group+perp_sex,df_type,direction=c('h','v','v'),highlighting_fill=color, labeling = vcd::labeling_border(rot_labels = c(0, 0, 90, 90), abbreviate_labs = c(5, 1, 1)))
```

Here we can see that the distribution of different crime types

```{r}
ggplot(data = high_freq_crime_types) +
   geom_mosaic(aes(x = product(perp_sex, perp_race), fill=ofns_desc), na.rm=TRUE) +  labs(x = "Crime Types ", ) + facet_grid(age_group~.)
```

