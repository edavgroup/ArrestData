---
title: "result"
author: "JUNYUAN HUANG"
output:
  html_document:
    fig_width: 5
    fig_height: 3.5
  pdf_document: default
---

```{r setup, include=FALSE}
# this prevents package loading message from appearing in the rendered version of your problem set
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```


```{r}
library(dplyr)
library(tibble)
library(tidyr)
library(ggplot2)
library(forcats)
library(RSocrata)
library(redav)
library(UpSetR)
library(naniar)
library(ggmap)
library(cowplot)
library(hrbrthemes)
library(vcd)
library(ggmosaic)
```


```{r}
data =  read.socrata("https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc")
```


```{r}
head(data)
```
### Arrest data look on map

In this section, we explore the arrest distribution look on map.

```{r}
missing_data <- data
missing_data["pd_desc"][missing_data["pd_desc"] == "(null)"] <- NA
missing_data["arrest_boro"][missing_data["arrest_boro"] == "Q"] <- "Queens"
missing_data["arrest_boro"][missing_data["arrest_boro"] == "B"] <- "Bronx"
missing_data["arrest_boro"][missing_data["arrest_boro"] == "S"] <- "Staten Island"
missing_data["arrest_boro"][missing_data["arrest_boro"] == "K"] <- "Brooklyn"
missing_data["arrest_boro"][missing_data["arrest_boro"] == "M"] <- "Manhattan"

map_data <- missing_data %>%
  filter(!is.na(ky_cd))

```


```{r}

map_queen <- map_data %>%
  filter(arrest_boro == "Queens")

map_bronx <- map_data %>%
  filter(arrest_boro == "Bronx")

map_si <- map_data %>%
  filter(arrest_boro == "Staten Island")

map_brooklyn <- map_data %>%
  filter(arrest_boro == "Brooklyn")

map_manhattan <- map_data %>%
  filter(arrest_boro == "Manhattan")

ny_map <- get_stamenmap(bbox = c(left = -74.2591, bottom = 40.4774, 
                                 right = -73.7002, top = 40.9162),
                        zoom = 10, maptype = "terrain",
                        color = c("color", "bw"))

map1 <- ggmap(ny_map) +
  geom_point(data = map_queen, aes(x=longitude, y = latitude),
             size=0.1,color='#b3424a', alpha = 0.1) +
  labs(x = "Longitude", y = "Latitude", title = "Queens") + 
  theme_bw()

map2 <- ggmap(ny_map) +
  geom_point(data = map_bronx, aes(x=longitude, y = latitude),
             size=0.1,color='#b3424a', alpha = 0.1) +
  labs(x = "Longitude", y = "Latitude", title = "Bronx") + 
  theme_bw()

map3 <- ggmap(ny_map) +
  geom_point(data = map_si, aes(x=longitude, y = latitude),
             size=0.1,color='#b3424a', alpha = 0.1) +
  labs(x = "Longitude", y = "Latitude", title = "Staten Island") + 
  theme_bw()

map4 <- ggmap(ny_map) +
  geom_point(data = map_brooklyn, aes(x=longitude, y = latitude),
             size=0.1,color='#b3424a', alpha = 0.1) +
  labs(x = "Longitude", y = "Latitude", title = "Brooklyn") + 
  theme_bw()

map5 <- ggmap(ny_map) +
  geom_point(data = map_manhattan, aes(x=longitude, y = latitude),
             size=0.1,color='#b3424a', alpha = 0.1) +
  labs(x = "Longitude", y = "Latitude", title = "Manhattan") + 
  theme_bw()

plot_grid(map1,map2,map3,map4,map5, labels = NULL, ncol = 3)

```

From the figure above, we can find that arrest happend in Manhattan, Bronx and Brooklyn is relatively concentrated. For Queens and Staten Island, there are places that never have an arrest during the whole year.

```{r}
map_data %>%
  mutate(Freq = 1) %>%
  group_by(arrest_boro) %>%
  summarise(freq = sum(Freq)) %>%
  ggplot(aes(x=fct_reorder(arrest_boro,freq,.desc = TRUE),y=freq)) +
  geom_bar(stat = "identity",fill = "#dea32c", color = "black", alpha = 0.8) +
  geom_text(aes(label=freq), size=3.5, vjust=1.6)+
  labs(title = "Borough-wise arrest in New York in 2022" , x="", y="Number of Arrest") +
  theme_bw()
```

It turns out that the number of arrests occurred in Staten Island is the least, which is about 1/3 of that in other borough.


### Crimes over sex, race and age

```{r}

race <- c("BLACK","BLACK HISPANIC", "ASIAN / PACIFIC ISLANDER","WHITE","WHITE HISPANIC","Others")

race_data <- map_data
race_data["perp_race"][race_data["perp_race"] == "AMERICAN INDIAN/ALASKAN NATIVE"] <- "Others"
race_data["perp_race"][race_data["perp_race"] == "UNKOWN"] <- "Others"



race_data$perp_race <- factor(map_data$perp_race, levels = race)
ggplot(data = race_data) +
  geom_mosaic(aes(x = product(perp_race, age_group), fill = perp_sex),
              na.rm=TRUE,
              offset = 0.03)+
  labs(y="Race", x= "Age")+
  theme(axis.text.x= element_text(angle=-45),
        legend.title = element_blank())


```

From the mosaic plot above, we can see the age, gender, and race distribution of arrested people. Overall, males make up the vast majority of all arrests. For age, the arrest rate of 25-44 is the highest among all age groups, followed by 18-24 and 45-60. With the weakening of activity, the arrest rate also decreases. For race, black and white Hispanics are the two main arrest groups, black and white Hispanics are the two main groups of arrests, and the least arrested races are American Indian and Alaskan natives, which are categorized into "Others".
